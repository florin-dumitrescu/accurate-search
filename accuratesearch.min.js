class AccurateSearch{constructor(){this.c=[]}addText(t,e,l=0){if(t&&e){let i=this.cleanupText(e);if(i.length>1e3){let t=i.lastIndexOf(" ",1e3);i=i.substr(0,t)}y({i:t,t:i},this.c);let r=i.split(" ");this.t||(this.t={d:{},i:[],n:{}});for(let e of r)if(e&&e.length>0){let r=this.t;for(var n=0;n<e.length;n++){let t=e.charAt(n);r.n[t]||(r.n[t]={d:{},i:[],n:{}}),r=r.n[t]}let h=1+i.indexOf(e);l&&(h+=l),(!r.d[t]||r.d[t]>h)&&(r.d[t]=h,r.i.includes(t)||r.i.push(t))}}}search(t){let l=this.cleanupText(t).split(" "),n={},i={};for(let t of l)if(t){let l,r=this.t;for(l=0;l<t.length;l++){let e=r.n[t.charAt(l)];if(!e)break;r=e}l===t.length&&e(t,r,n,i,4)}let r={};for(let t in n){let e=n[t][0],l=n[t][1];r[e]||(r[e]={}),r[e][l]||(r[e][l]=[]),r[e][l].push(t)}let s=[];for(let t in r){let e=r[t];for(let t in e)h(s,e[t])}return s}suggestions(t,e){t=this.cleanupText(t);let l=[];for(let n of this.c){let i=n.t;if(i.length>t.length){let e=i.indexOf(t);if(e>=0&&(0===e||" "===i.charAt(e-1))){let n=i.indexOf(" ",e+t.length+1);i=n>0?i.substr(e,n-e):i.substr(e),i.length>t.length&&!l.includes(i)&&l.push(i)}}if(l.length>=e)break}return l.sort((t,e)=>t.length-e.length),l}remove(t){for(let e=0;e<this.c.length;e++)this.c[e].i===t&&this.c.splice(e,1);let e=this.t;if(e)for(let l in e.n)d(t,e.n[l])}cleanupText(t){return(t=t.replace(/<[^>]*>?/gm," ")).toLowerCase().replace(/[`~!%^*()_|=?;:",\.<>\{\}\[\]\\\/]/g," ").trim()}}function e(t,l,n,i,r){i[t]||(i[t]={});for(let e of l.i)if(!i[t][e]){i[t][e]=!0,n[e]||(n[e]=[],n[e][0]=1e4,n[e][1]=0);let h=r;n[e][0]-=h,n[e][1]+=l.d[e]}for(let h in l.n)e(t,l.n[h],n,i,r>1?r/2:1)}function d(t,e){let l=e.i.indexOf(t);l>=0&&e.i.splice(l,1);for(let l in e.n)d(t,e.n[l])}function y(t,e,l,n){var i=e.length,r=void 0!==l?l:0,h=void 0!==n?n:i-1,s=r+Math.floor((h-r)/2);0!=i?p(t,e[h])>=0?e.splice(h+1,0,t):p(t,e[r])<=0?e.splice(r,0,t):r>=h?e.splice(r,0,t):p(t,e[s])<=0?y(t,e,r,s-1):y(t,e,s+1,h):e.push(t)}function p(t,e){return t.r?e.r?e.r-t.r:-1:e.r?1:t.l-e.l}function h(t,e){let l=t.length,n=e.length;t.length+=n;for(let i=0;i<n;i++)t[l+i]=e[i]}module.exports=AccurateSearch;