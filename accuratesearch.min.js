class AccurateSearch{c;t;s;i;constructor(e){this.c=[],this.s=!1,this.i=!0,e&&"object"==typeof e&&(e.engine&&"speed"===e.engine&&(this.s=!0),void 0!==e.insideWords&&!1===e.insideWords&&(this.i=!1))}search(e){let t=e.toLowerCase(),i=this.cleanupText(e).split(" ");if(this.s){let e={},t={};for(let s of i)if(s){let i,l=this.t;for(i=0;i<s.length;i++){let e=l.n[s.charAt(i)];if(!e)break;l=e}i===s.length&&s31(s,l,e,t,16)}let s={};for(let t in e){let i=e[t];s[i]||(s[i]=[]),s[i].push(t)}let l=[];for(let e in s)l.unshift(...s[e]);return l}{let e=" "+t,s=t+" ",l=[],n=[],h=[],r=[],f=[],o=[],c=[],p=[],a=[];for(let d=0;d<this.c.length;d++){let g=this.c[d],x=g.i,O=g.t,b=g.w;if(O===t)l.push(x);else if(O.startsWith(s))n.push(x);else if(O.startsWith(t))h.push(x);else if(1===i.length){let e=u(i,b,this.i);e>0&&(3===e?o.push(x):2===e?c.push(x):1===e&&p.push(x))}else if(O.indexOf(e)>=0)r.push(x);else if(this.i&&O.indexOf(t)>=0)f.push(x);else{let e=u(i,b,this.i);e>0&&a.push({s:e,i:x})}}let d=l.concat(n,h,r,f);if(1===i.length)d=d.concat(o,c,p);else{a.sort((e,t)=>t.s-e.s);for(let e of a)d.push(e.i)}return d}}suggestions(e,t){e=this.cleanupText(e);let i=[];for(let s of this.c){let l=s.t;if(l.length>e.length){let t=l.indexOf(e);if(t>=0&&(0===t||" "===l.charAt(t-1))){let s=l.indexOf(" ",t+e.length+1);l=s>0?l.substr(t,s-t):l.substr(t),l.length>e.length&&!i.includes(l)&&i.push(l)}}if(i.length>=t)break}return i.sort((e,t)=>e.length-t.length),i}addText(e,t,i){if(t){let l=this.cleanupText(t);if(l.length>1e3){let e=l.lastIndexOf(" ",1e3);l=l.substr(0,e)}let n={i:e,t:l,l:t.length};if(i&&(n.r=i),this.s){let t=l.split(" ");this.t||(this.t={d:{},i:[],n:{}});for(let i of t)if(i){let t=this.t;for(var s=0;s<i.length;s++){let e=i.charAt(s);t.n[e]||(t.n[e]={d:{},i:[],n:{}}),t=t.n[e]}t.i.push(e),t.d[e]=l.indexOf(i)}}else n.w=l.split(" "),y(n,this.c)}}remove(e){for(let t=0;t<this.c.length;t++)this.c[t].i===e&&this.c.splice(t,1)}cleanupText(e){return e.toLowerCase().replace(/[`~!@$%^*()_|=?;:",\.<>\{\}\[\]\\\/]/g," ").trim()}}function s31(e,t,i,s,l){s[e]||(s[e]={});for(let n of t.i)s[e][n]||(s[e][n]=!0,i[n]?i[n]+=l:i[n]=l);for(let n in t.n)s31(e,t.n[n],i,s,l>1?l/2:1)}function u(e,t,i){let s=0;if(i)for(let i of e)if(t.indexOf(i)>=0)s+=3;else{let e=0;for(let s of t){let t=s.indexOf(i);if(0===t){e=2;break}t>0&&(e=1)}s+=e}else for(let i of e)if(t.indexOf(i)>=0)s+=3;else{let e=0;for(let s of t)if(s.startsWith(i)){e=2;break}s+=e}return s}function y(e,t,i,s){var l=t.length,n=void 0!==i?i:0,h=void 0!==s?s:l-1,r=n+Math.floor((h-n)/2);0!=l?p(e,t[h])>=0?t.splice(h+1,0,e):p(e,t[n])<=0?t.splice(n,0,e):n>=h?t.splice(n,0,e):p(e,t[r])<=0?y(e,t,n,r-1):y(e,t,r+1,h):t.push(e)}function p(e,t){return e.r?t.r?t.r-e.r:-1:t.r?1:e.l-t.l}module.exports=AccurateSearch;