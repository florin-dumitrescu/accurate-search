class AccurateSearch{constructor(e){this.c=[],this.s=!1,this.i=!0,e&&"object"==typeof e&&(e.engine&&"speed"===e.engine&&(this.s=!0),void 0!==e.insideWords&&!1===e.insideWords&&(this.i=!1))}addText(e,t,i){if(t){let l=this.cleanupText(t);if(l.length>1e3){let e=l.lastIndexOf(" ",1e3);l=l.substr(0,e)}if(this.s){let t=l.split(" ");this.t||(this.t={d:{},i:[],n:{}});for(let i of t)if(i){let t=this.t;for(var s=0;s<i.length;s++){let e=i.charAt(s);t.n[e]||(t.n[e]={d:{},i:[],n:{}}),t=t.n[e]}t.i.push(e),t.d[e]=l.indexOf(i)}}else{let s={i:e,t:l,w:l.split(" "),l:t.length};i&&(s.r=i),y(s,this.c)}}}search(t){let i=t.toLowerCase(),s=this.cleanupText(t).split(" ");if(this.s){let t={},i={};for(let l of s)if(l){let s,n=this.t;for(s=0;s<l.length;s++){let e=n.n[l.charAt(s)];if(!e)break;n=e}s===l.length&&e(l,n,t,i,16)}let l={};for(let e in t){let i=t[e];l[i]||(l[i]=[]),l[i].push(e)}let n=[];for(let e in l)n.unshift(...l[e]);return n}{let e=" "+i,t=i+" ",l=[],n=[],r=[],f=[],h=[],o=[],c=[],p=[],a=[];for(let d=0;d<this.c.length;d++){let g=this.c[d],x=g.i,O=g.t,b=g.w;if(O===i)l.push(x);else if(O.startsWith(t))n.push(x);else if(O.startsWith(i))r.push(x);else if(1===s.length){let e=u(s,b,this.i);e>0&&(3===e?o.push(x):2===e?c.push(x):1===e&&p.push(x))}else if(O.indexOf(e)>=0)f.push(x);else if(this.i&&O.indexOf(i)>=0)h.push(x);else{let e=u(s,b,this.i);e>0&&a.push({s:e,i:x})}}let d=l.concat(n,r,f,h);if(1===s.length)d=d.concat(o,c,p);else{a.sort((e,t)=>t.s-e.s);for(let e of a)d.push(e.i)}return d}}suggestions(e,t){e=this.cleanupText(e);let i=[];for(let s of this.c){let l=s.t;if(l.length>e.length){let t=l.indexOf(e);if(t>=0&&(0===t||" "===l.charAt(t-1))){let s=l.indexOf(" ",t+e.length+1);l=s>0?l.substr(t,s-t):l.substr(t),l.length>e.length&&!i.includes(l)&&i.push(l)}}if(i.length>=t)break}return i.sort((e,t)=>e.length-t.length),i}remove(e){for(let t=0;t<this.c.length;t++)this.c[t].i===e&&this.c.splice(t,1);let t=this.t;if(t)for(let i in t.n)d(e,t.n[i])}cleanupText(e){return e.toLowerCase().replace(/[`~!%^*()_|=?;:",\.<>\{\}\[\]\\\/]/g," ").trim()}}function e(t,i,s,l,n){l[t]||(l[t]={});for(let e of i.i)l[t][e]||(l[t][e]=!0,s[e]?s[e]+=n:s[e]=n);for(let r in i.n)e(t,i.n[r],s,l,n>1?n/2:1)}function d(e,t){let i=t.i.indexOf(e);i>=0&&t.i.splice(i,1);for(let i in t.n)d(e,t.n[i])}function u(e,t,i){let s=0;if(i)for(let i of e)if(t.indexOf(i)>=0)s+=3;else{let e=0;for(let s of t){let t=s.indexOf(i);if(0===t){e=2;break}t>0&&(e=1)}s+=e}else for(let i of e)if(t.indexOf(i)>=0)s+=3;else{let e=0;for(let s of t)if(s.startsWith(i)){e=2;break}s+=e}return s}function y(e,t,i,s){var l=t.length,n=void 0!==i?i:0,r=void 0!==s?s:l-1,f=n+Math.floor((r-n)/2);0!=l?p(e,t[r])>=0?t.splice(r+1,0,e):p(e,t[n])<=0?t.splice(n,0,e):n>=r?t.splice(n,0,e):p(e,t[f])<=0?y(e,t,n,f-1):y(e,t,f+1,r):t.push(e)}function p(e,t){return e.r?t.r?t.r-e.r:-1:t.r?1:e.l-t.l}module.exports=AccurateSearch;