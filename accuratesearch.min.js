class AccurateSearch{constructor(){}addText(t,e,l=0){if(void 0===t)throw"id is a required parameter";let r=this.cleanupText(e);if(r.length>1e3){let t=r.lastIndexOf(" ",1e3);r=r.substr(0,t)}this.c||(this.c=[]),y({i:t,t:r},this.c);let i=r.split(" ");this.t||(this.t={d:{},i:[],n:{}}),l>1e3&&(l=1e3),l=Math.floor(l);for(let e of i){let i=this.t;for(var n=0;n<e.length;n++){let t=e.charAt(n);i.n[t]||(i.n[t]={d:{},i:[],n:{}}),i=i.n[t]}let h=1+r.indexOf(e);l&&(h+=l),i.d[t]?i.d[t]>h&&(i.d[t]=h):(i.d[t]=h,i.i.push(t))}}search(t){let e=this.accurateSearch(t);return 0==e.length&&(e=this.fuzzySearch(t)),e}accurateSearch(t){let l=this.cleanupText(t).split(" ");if(!this.t)throw"There is no text added to search index";let r={},i={};for(let t of l)if(t){let l,n=this.t;for(l=0;l<t.length;l++){let e=n.n[t.charAt(l)];if(!e)break;n=e}l===t.length&&e(t,n,r,i,4)}let n={};for(let t in r){let e=r[t][0],l=r[t][1];n[e]||(n[e]={}),n[e][l]||(n[e][l]=[]),n[e][l].push(t)}let s=[];for(let t in n){let e=n[t];for(let t in e)h(s,e[t])}return s}fuzzySearch(t){let e;for(let l=4;l>1;l--){let r=t;for(let i=t.length-1;i>=l&&(r+=" "+t.substr(0,i),e=this.accurateSearch(r),!(e.length>0));i--);}return e}suggestions(t,e){t=this.cleanupText(t);let l=[];for(let r of this.c){let i=r.t;if(i.length>t.length){let e=i.indexOf(t);if(e>=0&&(0===e||" "===i.charAt(e-1))){let r=i.indexOf(" ",e+t.length+1);i=r>0?i.substr(e,r-e):i.substr(e),i.length>t.length&&!l.includes(i)&&l.push(i)}}if(l.length>=e)break}return l.sort((t,e)=>t.length-e.length),l}remove(t){for(let e=0;e<this.c.length;e++)this.c[e].i===t&&this.c.splice(e,1);let e=this.t;if(e)for(let l in e.n)d(t,e.n[l])}cleanupText(t){return(t=t.replace(/<[^>]*>?/gm," ")).toLowerCase().replace(/[`~!%^*()_|=?;:",\.<>\{\}\[\]\\\/]/g," ").trim()}}function e(t,l,r,i,n){i[t]||(i[t]={});for(let e of l.i)if(!i[t][e]){i[t][e]=!0,r[e]||(r[e]=[],r[e][0]=1e5,r[e][1]=0);let h=n;r[e][0]-=h,r[e][1]+=l.d[e]}for(let h in l.n)e(t,l.n[h],r,i,n>1?n/2:1)}function d(t,e){let l=e.i.indexOf(t);l>=0&&e.i.splice(l,1);for(let l in e.n)d(t,e.n[l])}function y(t,e,l,r){var i=e.length,n=void 0!==l?l:0,h=void 0!==r?r:i-1,s=n+Math.floor((h-n)/2);0!=i?p(t,e[h])>=0?e.splice(h+1,0,t):p(t,e[n])<=0?e.splice(n,0,t):n>=h?e.splice(n,0,t):p(t,e[s])<=0?y(t,e,n,s-1):y(t,e,s+1,h):e.push(t)}function p(t,e){return t.r?e.r?e.r-t.r:-1:e.r?1:t.l-e.l}function h(t,e){let l=t.length,r=e.length;t.length+=r;for(let i=0;i<r;i++)t[l+i]=e[i]}module.exports=AccurateSearch;