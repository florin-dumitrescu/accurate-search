class AccurateSearch{constructor(){}addText(t,e,l=0){if(void 0===t)throw"id is a required parameter";let i=this.cleanupText(e);if(i.length>1e3){let t=i.lastIndexOf(" ",1e3);i=i.substr(0,t)}this.c||(this.c=[]),y({i:t,t:i},this.c);let n=i.split(" ");this.t||(this.t={d:{},i:[],n:{}}),l>1e3&&(l=1e3),l=Math.floor(l);for(let e of n){let n=this.t;for(var r=0;r<e.length;r++){let t=e.charAt(r);n.n[t]||(n.n[t]={d:{},i:[],n:{}}),n=n.n[t]}let h=1+i.indexOf(e);l&&(h+=l),(!n.d[t]||n.d[t]>h)&&(n.d[t]=h,n.i.includes(t)||n.i.push(t))}}search(t){let l=this.cleanupText(t).split(" ");if(!this.t)throw"There is no text added to search index";let i={},n={};for(let t of l)if(t){let l,r=this.t;for(l=0;l<t.length;l++){let e=r.n[t.charAt(l)];if(!e)break;r=e}l===t.length&&e(t,r,i,n,4)}let r={};for(let t in i){let e=i[t][0],l=i[t][1];r[e]||(r[e]={}),r[e][l]||(r[e][l]=[]),r[e][l].push(t)}let s=[];for(let t in r){let e=r[t];for(let t in e)h(s,e[t])}return s}suggestions(t,e){t=this.cleanupText(t);let l=[];for(let i of this.c){let n=i.t;if(n.length>t.length){let e=n.indexOf(t);if(e>=0&&(0===e||" "===n.charAt(e-1))){let i=n.indexOf(" ",e+t.length+1);n=i>0?n.substr(e,i-e):n.substr(e),n.length>t.length&&!l.includes(n)&&l.push(n)}}if(l.length>=e)break}return l.sort((t,e)=>t.length-e.length),l}remove(t){for(let e=0;e<this.c.length;e++)this.c[e].i===t&&this.c.splice(e,1);let e=this.t;if(e)for(let l in e.n)d(t,e.n[l])}cleanupText(t){return(t=t.replace(/<[^>]*>?/gm," ")).toLowerCase().replace(/[`~!%^*()_|=?;:",\.<>\{\}\[\]\\\/]/g," ").trim()}}function e(t,l,i,n,r){n[t]||(n[t]={});for(let e of l.i)if(!n[t][e]){n[t][e]=!0,i[e]||(i[e]=[],i[e][0]=1e5,i[e][1]=0);let h=r;i[e][0]-=h,i[e][1]+=l.d[e]}for(let h in l.n)e(t,l.n[h],i,n,r>1?r/2:1)}function d(t,e){let l=e.i.indexOf(t);l>=0&&e.i.splice(l,1);for(let l in e.n)d(t,e.n[l])}function y(t,e,l,i){var n=e.length,r=void 0!==l?l:0,h=void 0!==i?i:n-1,s=r+Math.floor((h-r)/2);0!=n?p(t,e[h])>=0?e.splice(h+1,0,t):p(t,e[r])<=0?e.splice(r,0,t):r>=h?e.splice(r,0,t):p(t,e[s])<=0?y(t,e,r,s-1):y(t,e,s+1,h):e.push(t)}function p(t,e){return t.r?e.r?e.r-t.r:-1:e.r?1:t.l-e.l}function h(t,e){let l=t.length,i=e.length;t.length+=i;for(let n=0;n<i;n++)t[l+n]=e[n]}module.exports=AccurateSearch;